import type { A3ReportInput } from './types.ts';

export function buildImproveInputPrompt(text: string, fieldType: keyof A3ReportInput): string {
  const fieldGuidance: Record<keyof A3ReportInput, string> = {
    what: `Улучши описание для поля "Что (What)" по методике 5W1H.

ВАЖНО: Поле "Что" описывает ТОЛЬКО СУТЬ проблемы - что именно не работает или работает неправильно.

ЗАПРЕЩЕНО добавлять:
- Цифры и проценты (это для поля "Как")
- Последствия и влияние на бизнес (это для поля "Почему")
- Места и подразделения (это для поля "Где")
- Людей и ответственных (это для поля "Кто")

МОЖНО:
- Конкретизировать суть проблемы
- Уточнить, что именно работает неправильно
- Сделать формулировку чёткой и понятной

Исходный текст: "${text}"

Верни ТОЛЬКО улучшенный текст (1-2 предложения максимум) без пояснений.`,

    where: `Улучши описание для поля "Где (Where)" по методике 5W1H.

ВАЖНО: Поле "Где" описывает ТОЛЬКО место или процесс, где происходит проблема.

ЗАПРЕЩЕНО добавлять:
- Суть проблемы (это для поля "Что")
- Цифры и метрики (это для поля "Как")
- Последствия (это для поля "Почему")

МОЖНО:
- Конкретизировать место (цех, участок, линия)
- Указать подразделение или отдел
- Уточнить процесс или этап производства

Исходный текст: "${text}"

Верни ТОЛЬКО улучшенный текст (1-2 предложения максимум) без пояснений.`,

    when: `Улучши описание для поля "Когда (When)" по методике 5W1H.

ВАЖНО: Поле "Когда" описывает ТОЛЬКО ЭТАП ПРОЦЕССА, на котором возникает проблема.

ЗАПРЕЩЕНО добавлять:
- Суть проблемы (это для поля "Что")
- Место или подразделение (это для поля "Где")
- Последствия (это для поля "Почему")
- Конкретное время, даты, периоды (фокус на этапе, а не на времени)

МОЖНО:
- Указать конкретный этап процесса или операции
- Уточнить, на какой стадии производства проявляется проблема
- Описать технологический момент возникновения

Исходный текст: "${text}"

Верни ТОЛЬКО улучшенный текст (1-2 предложения максимум) без пояснений.`,

    who: `Улучши описание для поля "Кто (Who)" по методике 5W1H.

ВАЖНО: Поле "Кто" описывает ТОЛЬКО людей, роли и подразделения, связанные с проблемой.

ЗАПРЕЩЕНО добавлять:
- Суть проблемы (это для поля "Что")
- Последствия (это для поля "Почему")
- Цифры (это для поля "Как")

МОЖНО:
- Указать конкретные роли и должности
- Перечислить вовлечённые подразделения
- Уточнить, кто выявил проблему
- Указать ответственных

Исходный текст: "${text}"

Верни ТОЛЬКО улучшенный текст (1-2 предложения максимум) без пояснений.`,

    why: `Улучши описание для поля "Почему (Why)" по методике 5W1H.

ВАЖНО: Поле "Почему" описывает критичность, последствия и влияние на бизнес.

ЗДЕСЬ должны быть:
- Почему это критично
- Какие последствия для бизнеса
- Влияние на качество, сроки, затраты
- Риски, если не решить проблему

ЗАПРЕЩЕНО добавлять:
- Конкретные цифры и проценты (это для поля "Как")
- Суть самой проблемы (это для поля "Что")

Исходный текст: "${text}"

Верни ТОЛЬКО улучшенный текст (2-3 предложения максимум) без пояснений.`,

    how: `Улучши описание для поля "Как (How)" по методике 5W1H.

ВАЖНО: Поле "Как" описывает проявления проблемы в КОНКРЕТНЫХ цифрах и фактах.

ЗДЕСЬ должны быть:
- Конкретные цифры, проценты, количества
- Частота проявления (сколько раз, как часто)
- Затронутые KPI и метрики
- Объёмы, масштаб в числах

ЗАПРЕЩЕНО добавлять:
- Последствия и влияние (это для поля "Почему")
- Общие слова без цифр

Исходный текст: "${text}"

Верни ТОЛЬКО улучшенный текст с конкретными цифрами (2-3 предложения максимум) без пояснений.`
  };

  return fieldGuidance[fieldType];
}
